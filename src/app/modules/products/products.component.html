<div class="content position-relative d-flex">
  <ng-container *ngIf="screenWidth >= 768">
    <app-filters
      *ngIf="!loading"
      [currentCategory]="currentCategory"
      [brandFilters]="brandFilters"
      [minSelectedAmount]="minSelectedAmount"
      [maxSelectedAmount]="maxSelectedAmount"
      (emitFilteredProducts)="updateProductsList($event)"
      (emitPageIndex)="updatePageIndex($event)"
    ></app-filters>
  </ng-container>

  <ng-container *ngIf="screenWidth < 768">
    <button
      color="accent"
      mat-flat-button
      class="position-fixed filters-button"
      (click)="toggleFiltersModal()"
    >
      Ver filtros
    </button>
  </ng-container>

  <div class="col-12 col-md-9" *ngIf="!loading; else loadingSpinner">
    <div *ngIf="productListLength; else noResults">
      <div class="products">
        <mat-card *ngFor="let product of productsList" class="product">
          <a [routerLink]="['/product', product.slug]">
            <mat-card-content class="d-flex flex-column">
              <img
                [src]="
                  'https://mitrahukum.org/wp-content/uploads/2012/09/dummy-post-square-1-768x768.jpg'
                "
                *ngIf="product.images!.length === 0; else oneOrMoreImages"
                alt=""
                class="product-image"
              />
              <ng-template #oneOrMoreImages>
                <img
                  [src]="product.images![0].image"
                  *ngIf="product.images!.length === 1; else multipleImages"
                  alt=""
                  class="product-image align-self-center"
                />
                <ng-template #multipleImages>
                  <app-products-carousel
                    (click)="$event.stopPropagation()"
                    [productImages]="product.images!"
                  ></app-products-carousel>
                </ng-template>
              </ng-template>
              <div>
                <div class="d-flex justify-content-between align-items-center">
                  <p class="my-3 fs-3 color-accent fw-bold">
                    â‚¬{{ product.price }}
                  </p>
                </div>
                <h4 class="">{{ product.brand }} {{ product.model }}</h4>
              </div>
            </mat-card-content>
          </a>
        </mat-card>
      </div>
      <app-paginator
        [pageSize]="9"
        [pageIndex]="pageIndex"
        [productsList]="productsList"
        [paginationLength]="productListLength"
        (onPageChange)="onPageChange($event)"
      ></app-paginator>
    </div>

    <ng-template #noResults>
      <p>No se encontraron resultados para los filtros ingresados.</p>
    </ng-template>
  </div>

  <ng-template #loadingSpinner>
    <div class="loading-spinner-container">
      <app-loading-spinner class="loading-spinner"></app-loading-spinner>
    </div>
  </ng-template>
</div>
